# unique-dirs

### Winnow a list of paths to a unique list of directories of interest

### Description

Winnow a list of pathnames.

Select only directories.
Select directory names of interest.
Prune all path components _below_ the directories of interest.
Keep only unique occurrences of the directory path names that remain.

If the list is still larger than desired, then
sort by the remaining paths by score,
where "score" is how many occurrences of names of interest
have occurred _below_ that path, even if those lower-level
components have been pruned in some earlier stage.

### Input

A list of pathnames from files named on the command line,
or from standard input.

### Output

A smaller list of directory names
that contain components of interest.

### Why

List of pathnames that are generated by other programs,
such as `locate` or `find`,
often contain too much detail.

We may be interested in just the top-level directory
of some project, but if we ask `locate`,
it will produce everything underneath that directory,
because they _all_ match.

`unique-dirs` has a multi-stage process to winnow the list.
It can explicitly include and exclude path.
More useful is that it can favor path components
(simple filenames) matching given patterns.

There is a scoring system based on awarding top-level directories
accumulated partial credit for containing components of interest 
somewhere below.

Often, the top scoring directories are the ones I really am
interested in.

## Options

--verbose

--debug

--include-path _pattern_

Explicitly include ONLY paths matching these patterns.

--exclude-path  _pattern_

Exclude a given directory prefix.

There can be many `--include-path` and/or `--exclude-path` options.

This is useful for trimming "noise",
like disk volumes containing backups / mirrors.

--include-sfn  _pattern_

Explicitly include simple file names matching pattern(s).

--exclude-sfn _pattern_

Explicitly exclude simple file names matching pattern(s).

The way filtering on simple filenames is different from
inclusion / exclusion of pathnames.

Simple filename patterns are applied to each path component,
from right to left,  that is from deeper in the path, first.

The path keeps getting pruned, until ANY simple filename of interest
is found. The resulting, shorter path survives the winnowing process,
but all of its children that were not interesting get pruned away.

Path patterns and simple-filename patterns are Perl regular expressions.


--max-size _size_

The maximum number of line of output.

Even after the first winnowing process,
the resulting list of directories may be too long.
This is where the scoring system comes in.

The remaining directories are sorted by score,
and the top _size_ directories are printed.

--show-score

Normally, only the surviving directory paths are printed.
But, with this option, each directory is followed by its score,
in parentheses.

## Example

```

locate --all dtrace linux \
| unique-dirs --exclude-path  '^/backup/' --exclude-path  '/mirror/' \
    --include-sfn 'dtrace' \
    --max-size=20 --score
```

## Result

```
/vdirs/shaw/psdk/pdsrc/linux (98)
/vdirs/shaw/psdk/pdsrc/linux/arc/dtrace (2)
/vdirs/shaw/psdk/pdsrc/linux/wrk/dtrace (391)
/vdirs/shaw/psdk/pdsrc/linux/wrk/dtrace/dtrace-20120524 (781)
/vdirs/shaw/psdk/pdsrc/linux/wrk/dtrace/dtrace-20120524/cmd/dtrace (3)
/vdirs/shaw/psdk/pdsrc/linux/wrk/dtrace/dtrace-20120524/demo/dtrace (4)
/vdirs/shaw/psdk/pdsrc/linux/wrk/dtrace/dtrace-20120524/libdtrace (87)

```

## License

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

##

-- Guy Shaw

   gshaw@acm.org

